






<!-- /*
* Bootstrap 5
* Template Name: Furni
* Template Author: Untree.co
* Template URI: https://untree.co/
* License: https://creativecommons.org/licenses/by/3.0/
*/ -->
<%@page language="java" contentType="text/html" pageEncoding="UTF-8" %>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Untree.co">
  <link rel="shortcut icon" href="favicon.png">

  <meta name="description" content="" />
  <meta name="keywords" content="bootstrap, bootstrap4" />

		<!-- Bootstrap CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
		<link href="css/tiny-slider.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet">
		<title>Store Enhancer</title>
		
	   <script type="text/javascript"> 
        function preventBack() { 
            window.history.forward();  
        } 
          
        setTimeout("preventBack()", 0); 
          
        window.onunload = function () { null }; 
    </script> 
    
    
	</head>


	<body>

		<!-- Start Header/Navigation -->
		<nav class="custom-navbar navbar navbar navbar-expand-md navbar-dark bg-dark" arial-label="Furni navigation bar">

			<div class="container">
				<a class="navbar-brand" href="index.html">Store Enhancer<span>.</span></a>

				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsFurni" aria-controls="navbarsFurni" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>

				<div class="collapse navbar-collapse" id="navbarsFurni">
					<ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
						<li class="nav-item active">
							<a class="nav-link" href="index.html">Home</a>
						</li>
						<li><a class="nav-link" href="shop.html">Log-In</a></li> 
								<li><a class="nav-link" href="production.jsp">Production Daily Report</a></li>
						
						<li><a class="nav-link" href="production3.jsp">Display Production Report</a></li>
						
						
						
					</ul>

					<ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
						
					</ul>
				</div>
			</div>
				
		</nav>
		<!-- End Header/Navigation -->

		<!-- Start Hero Section -->
			<div class="hero">
				<div class="container">
					<div class="row justify-content-between">
						<div class="col-lg-5">
							<div class="intro-excerpt">
								<h1>Shift Report</h1>
								<p class="mb-4">Core Press Shift Report</p>
								
							</div>
						</div>
						<div class="col-lg-7">
							<div class="hero-img-wrap">
								<img src="images/couch.png" class="img-fluid">
							</div>
						</div>
					</div>
				</div>
			</div>
		<!-- End Hero Section -->

		
		<!-- Start Contact Form -->
		<div class="untree_co-section">
      <div class="container">

        <div class="block">
          <div class="row justify-content-center">


            <div class="col-md-8 col-lg-8 pb-4">


              <div class="row mb-5">
                <div class="col-lg-4">
                  <div  class="service no-shadow align-items-center link horizontal d-flex active" data-aos="fade-left" data-aos-delay="0">
                    <div class="service-icon color-1 mb-4">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                        <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                      </svg>
                    </div> <!-- /.icon -->
                    <div class="service-contents">
                      <p>New Line Currency</p>
                    </div> <!-- /.service-contents-->
                  </div> <!-- /.service -->
                </div>

                <div class="col-lg-4">
                  <div  class="service no-shadow align-items-center link horizontal d-flex active" data-aos="fade-left" data-aos-delay="0">
                    <div class="service-icon color-1 mb-4">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope-fill" viewBox="0 0 16 16">
                        <path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558L0 4.697zM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z"/>
                      </svg>
                    </div> <!-- /.icon -->
                    <div class="service-contents">
                      <p>placevalue</p>
                    </div> <!-- /.service-contents-->
                  </div> <!-- /.service -->
                </div>

                <div class="col-lg-4">
                  <div  class="service no-shadow align-items-center link horizontal d-flex active" data-aos="fade-left" data-aos-delay="0">
                    <div class="service-icon color-1 mb-4">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone-fill" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>
                      </svg>
                    </div> <!-- /.icon -->
                    <div class="service-contents">
                      <p>Departmental Phone Number</p>
                    </div> <!-- /.service-contents-->
                  </div> <!-- /.service -->
                </div>
              </div>
	      
	      


  <% 
    
	out.println("  Your IP address is " + request.getRemoteAddr() +" and today's date is: " +  (new java.util.Date()).toLocaleString() );
	
	
	String shop_user_name = request.getParameter("user_name");
	String shop_user_password = request.getParameter("password");
	
	
	if ( shop_user_name == null ) {
	 shop_user_name = (String)session.getAttribute("user_name");
	 shop_user_password = (String)session.getAttribute("password");
	 
	
	  }
	
	else {
	  
	session.setAttribute("user_name",shop_user_name );
	session.setAttribute("password",shop_user_password );
	
	  }
	  
	//Global variable to store supplied login username and password from shop
	//String shop_user_name = request.getParameter("user_name");
	//String shop_user_password = request.getParameter("password");
	
	
	String user_namesd = "user_name";
	
	//session.setAttribute("user_name",shop_user_name );
	user_namesd = (String)session.getAttribute("user_name");
	
	
	
	
	
	
	out.println( "user name: "+user_namesd +" and password: "+(String)session.getAttribute("password") );
	
	
	//Global variables to store entry from database
	String contact_user_name = "";
	String contact_password = "";
	boolean contact_store_A = false;
	boolean contact_store_B = false;
	boolean contact_store_C = false;
	boolean contact_store_D = false;
	String department= "";
	
	
	
	
	
    
  %>
  
  
  
 
  
  <%@page import="java.sql.*" %>
  <% 
  // To connect to the database
  
  // Load postgresql Driver. The jar file was downloaded and placed in the lib folder of tomcat server
  
  try {
  Class.forName("org.postgresql.Driver"); 
  }
  catch(Exception e){out.println( e.getClass().getName()+": "+ e.getMessage() );
    }
  
  // Database logic
   String query1 = " select * from username where username = ?";

    Connection c = null;
    Statement stmt = null;
    PreparedStatement preparedStatement = null;
    ResultSet resultSet = null;
    
    	
    
      try {
         Class.forName("org.postgresql.Driver");
       
          c = DriverManager.getConnection("jdbc:postgresql://localhost:5432/sewa", "tyui_1", "jigger");
         
	 preparedStatement = c.prepareStatement(query1);
	  preparedStatement.setString(1, shop_user_name);
         
	
	 String sql = query1 ;
	 
	resultSet = preparedStatement.executeQuery();
	 
	  while (resultSet.next()) {
	    
	    contact_user_name = resultSet.getString("username") ;
	    contact_password =  resultSet.getString("password");
	    contact_store_A =   resultSet.getBoolean("storea");
	    contact_store_B =   resultSet.getBoolean("storeb");
	    contact_store_C =   resultSet.getBoolean("storec");
	    contact_store_D =   resultSet.getBoolean("stored");
	    department = resultSet.getString("department") ;
	    
	    
	  }
	  
	   
         
	 
         preparedStatement.close();
         c.close();
	
      } catch ( Exception e ) {
	out.println( e.getClass().getName()+": "+ e.getMessage() );
         
      }
      
      //End to connect to a database
      
  
  %>
  
  <%@ page import="java.time.LocalDate" %>
   <%@ page import="java.time.LocalTime" %>
  
  
 <%  
  
 
  
   if( contact_user_name.equals( shop_user_name)  && contact_password.equals( shop_user_password)     &&  ( department.equals( "production_corepress") || department.equals( "production_view") )      ){ 
   
   
   //if( contact_user_name.equals( shop_user_name)  && contact_password.equals( shop_user_password)        ){ 
   
    
    out.println("<br> Hello " +contact_user_name + "<br>"  );
   
     %>
  
  
  <BR>
  
   <%@page import="java.sql.*" %>
   
   
  
  
  <%
  
  //Test to see if a post was done
  
  if ("POST".equalsIgnoreCase(request.getMethod()) && request.getParameter("submit") != null) {
    
    //select batch from history_production where extract(MONTH FROM TO_DATE('2023/11/07', 'YYYY/MM/DD')  ) = 11;
    
    // To connect to the database
  
  // Load postgresql Driver. The jar file was downloaded and placed in the lib folder of tomcat server
  
  try {
  Class.forName("org.postgresql.Driver"); 
  }
  catch(Exception e){out.println( e.getClass().getName()+": "+ e.getMessage() );
    }
    
     // Database logic 
     
     // For batch

  String month = request.getParameter("month");
  int months = Integer.parseInt(month);
  
  
   
  String year = request.getParameter("year");
  int years = Integer.parseInt(year); 
  
   String  machine = request.getParameter("machine");
  
  
  String search_date = year+"/"+month ;
  out.println("Search Date: "+ search_date + " and searched machine is: "+ machine );
  
  String  query = "";
  String batch =" ";
  int reams = 0;
  int sheets = 0; 
  String total_output = " ";
  int minimum_shift = 0;
  int maximum_shift = 0;
  double  average = 0.00;
  double  start_finish = 0.00;
  double wiper = 0.00;
  double foil = 0.00;
  double  feeder = 0.00;
  double elect_breakdown = 0.00;
  double mech_breakdown = 0.00;
	    

    
    
          try {
         Class.forName("org.postgresql.Driver");
         
 c = DriverManager.getConnection("jdbc:postgresql://localhost:5432/sewa", "tyui_1", "jigger");
	 
	 //For batches in a month
	 
	 query =  "SELECT batch FROM history_production where EXTRACT('MONTH'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? AND  EXTRACT('YEAR'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? AND machine = ? ";


		 preparedStatement = c.prepareStatement(query);
		 preparedStatement.setInt(1, months);
		 preparedStatement.setInt(2, years);
		 preparedStatement.setString(3, machine);
	 
	 resultSet = preparedStatement.executeQuery();
	 
	 while (resultSet.next()) { 
	   batch += " , "+resultSet.getString("batch");
	   }
	   // end of batch
	   
	   // For total output
	   
	   query = "SELECT SUM(CAST(reams AS int)) AS reamsd,  SUM(CAST(sheets  AS int)) AS sheetsd FROM history_production where EXTRACT('MONTH'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? AND  EXTRACT('YEAR'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? AND machine = ? ";
	   
	    preparedStatement = c.prepareStatement(query);
		 preparedStatement.setInt(1, months);
		 preparedStatement.setInt(2, years);
		 preparedStatement.setString(3, machine);
		 
	resultSet = preparedStatement.executeQuery();	  
		 
		 while (resultSet.next()) { 
	   reams = resultSet.getInt("reamsd");
	   sheets = resultSet.getInt("sheetsd");
	    total_output  = " "+reams + " reams "+ sheets+" sheets";
	    
	   }
	   // end of total output
	   
	   // For Minimum and maximum output / shift
	  
	   query =" SELECT MIN(CAST(reams AS int)) AS minimum , MAX(CAST(reams AS int)) AS maximum FROM history_production where  EXTRACT('MONTH'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? AND  EXTRACT('YEAR'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? AND  machine = ? ";
	   
		 preparedStatement = c.prepareStatement(query);
		 preparedStatement.setInt(1, months);
		 preparedStatement.setInt(2, years);
		 preparedStatement.setString(3, machine);
		 
	resultSet = preparedStatement.executeQuery();	 
	   
	   while (resultSet.next()) { 
	   minimum_shift = resultSet.getInt("minimum");
	   maximum_shift = resultSet.getInt("maximum");
	    
	    
	   }
	   // end of minimum and maximum output /shift
	   
	   // For average
	   
	    query = "  SELECT AVG(CAST(reams AS int)) AS avg FROM history_production  where  EXTRACT('MONTH'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? AND  EXTRACT('YEAR'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? AND machine= ? ";
	   
		 preparedStatement = c.prepareStatement(query);
		 preparedStatement.setInt(1, months);
		 preparedStatement.setInt(2, years);
		 preparedStatement.setString(3, machine);
		 
	   	resultSet = preparedStatement.executeQuery();	 
		
		   while (resultSet.next()) { 
	   average = resultSet.getDouble("avg");
	   
	    
	    
	   }
	   // end of minimum and maximum output /shift
	   
	   // For start/ Finish, wiper change, foil change, feeder adj
	 query = " SELECT SUM(CAST(start_finish AS numeric)) AS start_finish,  SUM(CAST(wiper_change  AS numeric)) AS wiper, SUM(CAST(foil_change  AS numeric)) AS foil, SUM(CAST(feeder_adjustment  AS numeric)) AS feeder FROM history_production where EXTRACT('MONTH'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? AND  EXTRACT('YEAR'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? and machine= ? ";
	    
	    preparedStatement = c.prepareStatement(query);
		 preparedStatement.setInt(1, months);
		 preparedStatement.setInt(2, years);
		 preparedStatement.setString(3, machine);
		
	resultSet = preparedStatement.executeQuery();	 
		 
		 
		    while (resultSet.next()) { 
	   start_finish = resultSet.getDouble("start_finish");
	   wiper = resultSet.getDouble("wiper");
	   foil = resultSet.getDouble("foil");
	   feeder = resultSet.getDouble("feeder");
	    
	    
	   }
	   
	   
	   //End of start/ Finish, wiper change, foil change, feeder adj
	   
	   
	   //For electrical breakdown, mechanical breakdown 
	   
	  query = " SELECT SUM(CAST(elect_breakdown AS numeric)) AS elect_breakdown,  SUM(CAST(mech_breakdown  AS numeric)) AS mech_breakdown  FROM history_production where EXTRACT('MONTH'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? AND  EXTRACT('YEAR'  FROM TO_DATE(device_date, 'YYYY/MM/DD'))= ? and machine= ? ";
	   preparedStatement = c.prepareStatement(query);
		 preparedStatement.setInt(1, months);
		 preparedStatement.setInt(2, years);
		 preparedStatement.setString(3, machine);
	   
	   resultSet = preparedStatement.executeQuery();	
	   
	   
		    while (resultSet.next()) { 
		      
	   elect_breakdown = resultSet.getDouble("elect_breakdown");
	   mech_breakdown = resultSet.getDouble("mech_breakdown");
	   
	   } 
	   
	   // End of mechanical, electrical breakdown
	   
	   preparedStatement.close();
         c.close();
	 
       }catch(Exception e){out.println( e.getClass().getName()+": "+ e.getMessage() );}
    
    
    
     %>
    
    <form  name="myform"  action="production_monthly.jsp" class="row g-3" method="POST"  onsubmit="return validateform()">
              
                <div class="form-group">
                  <label class="text-black" for="email">Month</label>

		
		    <select name="month"    class="form-control"> 
		    <option value="1">January</option> 
		    <option value="2">February </option> 
		    <option value="3">March </option> 
		    <option value="4">April </option> 
		    <option value="5">May</option> 
		    <option value="6">June</option> 
		    <option value="7">July</option> 
		    <option value="8">August</option> 
		    <option value="9">September</option> 
		    <option value="10">October</option> 
		    <option value="11">November</option> 
		    <option value="12">December</option> 
		    </select>
                </div>
		
		      <div class="form-group">
                  <label class="text-black" for="email">Year</label>

		
		    <select name="year"    class="form-control"> 
		    <option value="2023">2023</option> 
		    <option value="2024">2024 </option> 
		    <option value="2025">2025 </option> 
		    <option value="2026">2026 </option> 
		    
		    </select>
                </div>
		
		 <div class="form-group">
                  <label class="text-black" for="email">Machine</label>

		
		    <select name="machine"    class="form-control"> 
		    <option value="SUSI">SUSI</option> 
		    <option value="SOI 1">SOI 1 </option> 
		    <option value="SOI 2">SOI 2 </option> 
		    <option value="SOI 3">SOI 3 </option> 
		    <option value="NotaScreen">NOTASCREEN</option> 
		    <option value="Komori">KOMORI</option> 
		    <option value="SUNU">SUNU</option> 
		    <option value="GIETZ">GIETZ</option> 
		    </select>
                </div>
		
		
	      
		
	
      <br />  <br /> <br />
             
                
                <div class="row">
                  		    <div class="form-group">
                     
                      
                      <div class="input-group mb-3">
					 <span class="input-group-text" id="basic-addon1">Batches</span>
					<label > <% out.println(batch);  %></label> 
                       
                          </div>
                          
			    <div class="input-group mb-3">
					 <span class="input-group-text" id="basic-addon1">Total Ouput</span>
					<label > <% out.println(total_output);  %></label>  
                          </div> 
			  
                        <div class="input-group mb-3">
					 <span class="input-group-text" id="basic-addon1">Minimum Ouput/ Shift</span>
					    <label > <% out.println(minimum_shift);  %></label> 
                          </div>    
                          
                       <div class="input-group mb-3">
					 <span class="input-group-text" id="basic-addon1">Maximum Output/ Shift</span>
					  <label > <% out.println(maximum_shift);  %></label>   
                          </div>       
                      
		        
                       
                          
                     
		      
                       <div class="input-group mb-3">
					 <span class="input-group-text" id="basic-addon1">Average</span>
					<label > <% out.println(average);  %></label> 
                          </div>  
                          
                        <div class="input-group mb-3">
					 <span class="input-group-text" id="basic-addon1">Start/ Finish</span>
					<label > <% out.println(start_finish);  %></label>
                          </div>
                          
                         <div class="input-group mb-3">
					 <span class="input-group-text" id="basic-addon1">Wiper Change</span>
				      <label > <% out.println(wiper);  %></label> 
                          </div>
                          
                       <div class="input-group mb-3">
					 <span class="input-group-text" id="basic-addon1">Board / Foil Change</span>
					<label > <% out.println(foil);  %></label> 
                          </div>
                          
                           <div class="input-group mb-3">
					 <span class="input-group-text" id="basic-addon1">Feeder Adjustment</span>
				      <label > <% out.println(feeder);  %></label> 
                          </div>
                          
                      <div class="input-group mb-3">
					 <span class="input-group-text" id="basic-addon1">Elect. Breakdown</span>
				      <label > <% out.println(elect_breakdown);  %></label> 
                          </div>
			  
		         <div class="input-group mb-3">
					 <span class="input-group-text" id="basic-addon1">Mech. Breakdown</span>
				      <label > <% out.println( mech_breakdown );  %></label> 
                          </div>
                            
                    
                    </div>
                     </div>

                
		
		<input type="submit" name="submit"  class="btn btn-primary-hover-outline"  value="Load" />
              </form>

            </div>

          </div>

        </div>

      </div>


    </div>
  </div>
<% } // end of if

  
  else{
  %>



              <form  name="myform"  action="production_monthly.jsp" class="row g-3" method="POST"  onsubmit="return validateform()">
              
                <div class="form-group">
                  <label class="text-black" for="email">Month</label>

		
		    <select name="month"    class="form-control"> 
		    <option value="1">January</option> 
		    <option value="2">February </option> 
		    <option value="3">March </option> 
		    <option value="4">April </option> 
		    <option value="5">May</option> 
		    <option value="6">June</option> 
		    <option value="7">July</option> 
		    <option value="8">August</option> 
		    <option value="9">September</option> 
		    <option value="10">October</option> 
		    <option value="11">November</option> 
		    <option value="12">December</option> 
		    </select>
                </div>
		
		      <div class="form-group">
                  <label class="text-black" for="email">Year</label>

		
		    <select name="year"    class="form-control"> 
		    <option value="2023">2023</option> 
		    <option value="2024">2024 </option> 
		    <option value="2025">2025 </option> 
		    <option value="2026">2026 </option> 
		    
		    </select>
                </div>
		
		
		 <div class="form-group">
                  <label class="text-black" for="email">Machine</label>

		
		    <select name="machine"    class="form-control"> 
		    <option value="SUSI">SUSI</option> 
		    <option value="SOI 1">SOI 1 </option> 
		    <option value="SOI 2">SOI 2 </option> 
		    <option value="SOI 3">SOI 3 </option> 
		    <option value="NotaScreen">NOTASCREEN</option> 
		    <option value="Komori">KOMORI</option> 
		    <option value="SUNU">SUNU</option> 
		    <option value="GIETZ">GIETZ</option> 
		    </select>
                </div>
		
		
	
                            
                    
                    </div>
                     </div>

                
		
		<input type="submit" name="submit"  class="btn btn-primary-hover-outline"  value="Load" />
              </form>

            </div>

          </div>

        </div>

      </div>


    </div>
  </div>
<% } %>
  <!-- End Contact Form -->

	<% }
	
	// For those meant to search for items alone
	else if( contact_user_name.equals( shop_user_name)  && contact_password.equals( shop_user_password)   ){
	  
	   out.println("<br> Please click on the search tab to continue" );
	  
	  // New location to be redirected
         
   String site = new String("http://15.46.78.200:8080/fumi/");
         response.setStatus(response.SC_MOVED_TEMPORARILY);
         response.setHeader("Location", site); 
	  
	  }
	
	else{ out.println("<br> Seems your login credentials are wrong, you can try again." ); }
	
	 %>	

	

		<script src="js/bootstrap.bundle.min.js"></script>
		<script src="js/tiny-slider.js"></script>
		<script src="js/custom.js"></script>
	</body>

</html>
